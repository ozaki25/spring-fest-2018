<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Observability with Spring-Based Distributed Systems | Spring Fest 2018</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/spring-fest-2018/assets/css/styles.09634a89.css" as="style"><link rel="preload" href="/spring-fest-2018/assets/js/app.09634a89.js" as="script"><link rel="preload" href="/spring-fest-2018/assets/js/6.d229d9ff.js" as="script"><link rel="prefetch" href="/spring-fest-2018/assets/css/1.styles.8eb308c1.css"><link rel="prefetch" href="/spring-fest-2018/assets/css/2.styles.a2bd3099.css"><link rel="prefetch" href="/spring-fest-2018/assets/js/1.8eb308c1.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/10.febcc01a.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/11.1cd7b66f.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/12.1f19ecf6.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/13.8b9c0905.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/14.c645b9f5.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/15.38065252.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/16.3e425ef2.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/17.fae3e6e8.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/18.ffb2b096.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/19.790c48e6.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/2.a2bd3099.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/20.c2857ee8.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/21.1daad431.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/22.87665903.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/23.93c086fc.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/24.51308b9b.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/25.4266236e.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/26.99ce27f6.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/27.9ac45d54.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/3.9378e134.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/4.5c19490d.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/5.ca23a0c0.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/7.cdcc80d9.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/8.eac14a68.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/9.5d5663db.js">
    <link rel="stylesheet" href="/spring-fest-2018/assets/css/1.styles.8eb308c1.css"><link rel="stylesheet" href="/spring-fest-2018/assets/css/2.styles.a2bd3099.css"><link rel="stylesheet" href="/spring-fest-2018/assets/css/styles.09634a89.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/spring-fest-2018/" class="home-link router-link-active"><!----> <span class="site-name">Spring Fest 2018</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><!---->  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>10:00〜10:45</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>11:00〜11:45</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>13:15〜14:00</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>14:15〜15:00</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/spring-fest-2018/page10.html" class="sidebar-link">Knative:Serving your Serverless Java Serviceon Kubernetes the 12-Factor way</a></li><li><a href="/spring-fest-2018/page11.html" class="active sidebar-link">Observability with Spring-Based Distributed Systems</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring-fest-2018/page11.html#observability概要" class="sidebar-link">Observability概要</a></li><li class="sidebar-sub-header"><a href="/spring-fest-2018/page11.html#observabilityの3要素" class="sidebar-link">Observabilityの3要素</a></li><li class="sidebar-sub-header"><a href="/spring-fest-2018/page11.html#putting-it-all-together" class="sidebar-link">Putting It All Together</a></li></ul></li><li><a href="/spring-fest-2018/page12.html" class="sidebar-link">AmazonCognito使って認証したい？それならSpring Security使いましょう！</a></li><li><a href="/spring-fest-2018/page13.html" class="sidebar-link">SpringBootで作るRESTful Web Service</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>15:30〜16:15</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>16:30〜17:15</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>17:30〜18:15</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="observability-with-spring-based-distributed-systems"><a href="#observability-with-spring-based-distributed-systems" aria-hidden="true" class="header-anchor">#</a> Observability with Spring-Based Distributed Systems</h1> <ul><li>Thomas Ludwig(楽天株式会社)</li> <li>↓違う講演のスライドだけどだいたい同じ
<ul><li>公開されたら差し替える</li></ul></li></ul> <iframe src="//www.slideshare.net/slideshow/embed_code/key/Abza9uvEmKkaEN" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" allowfullscreen="allowfullscreen" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;"></iframe> <div style="margin-bottom:5px"><strong><a href="//www.slideshare.net/tommyludwig/observability-with-springbased-distributed-systems" title="Observability with Spring-based distributed systems" target="_blank">Observability with Spring-based distributed systems</a></strong> from <strong><a href="https://www.slideshare.net/tommyludwig" target="_blank">Tommy Ludwig</a></strong></div> <h2 id="observability概要"><a href="#observability概要" aria-hidden="true" class="header-anchor">#</a> Observability概要</h2> <h3 id="observabilityとは"><a href="#observabilityとは" aria-hidden="true" class="header-anchor">#</a> Observabilityとは</h3> <ul><li>ツールと手段を組み合わせてデータとコンテキストから気づきを得る</li> <li>単純なモニタリングだけでなくもっと深いところまで
<ul><li>システムが大きくなると必ずどこかで障害が起きる</li></ul></li> <li>最近Observability流行ってるらしい</li></ul> <h3 id="なぜobservability"><a href="#なぜobservability" aria-hidden="true" class="header-anchor">#</a> なぜObservability</h3> <ul><li>UXを改善するため</li> <li>本番に似せた環境があっても全てが同じではない
<ul><li>ユーザも違う</li></ul></li> <li>自身をもって運用するならサービスの状態を把握しないといけない</li> <li>MTTR(mean time to recovery)が重要
<ul><li>障害が起きた時にどれだけ速く検知して直せるか</li></ul></li></ul> <h3 id="分散システム"><a href="#分散システム" aria-hidden="true" class="header-anchor">#</a> 分散システム</h3> <ul><li>別のプロセスで並行して処理</li> <li>複数のプロセスを跨るので難易度が高い
<ul><li>全てのプロセスの情報を見ないといけない</li></ul></li> <li>スケーリングでそのインスタンスにしかない情報が消えるかも</li></ul> <h2 id="observabilityの3要素"><a href="#observabilityの3要素" aria-hidden="true" class="header-anchor">#</a> Observabilityの3要素</h2> <ul><li>3要素
<ul><li>Logging</li> <li>Metrics</li> <li>Tracing</li></ul></li> <li>3要素かぶってる領域もあれば特化した領域もある</li> <li>どれか一つだけで全部できるというものではない
<ul><li>使い分けるのがベスト</li></ul></li></ul> <h3 id="logging-events"><a href="#logging-events" aria-hidden="true" class="header-anchor">#</a> Logging - Events</h3> <ul><li>メッセージを残して後でそれを見つけられるようにする</li> <li>分散システムだと各サービスがログをはくからどこを見ればいいか複雑
<ul><li>ログを一箇所に収集して見られるようにしたい</li></ul></li> <li>Spring Cloud Sleuth
<ul><li>ログにIDを振ってくれるのでサービスをまたがってもリクエストの流れを特定することができる</li></ul></li> <li>楽天トラベルでは
<ul><li>Spring Cloud Config</li> <li>Travel Auto-configuration
<ul><li>独自ライブラリ</li> <li>セッションIDみたいなものを振って同じユーザが何度もアクセスした時に紐付ける</li></ul></li> <li>ELK
<ul><li>Elasticsearch</li> <li>Logstash</li> <li>Kibana</li></ul></li></ul></li></ul> <h3 id="metrics-aggregatable"><a href="#metrics-aggregatable" aria-hidden="true" class="header-anchor">#</a> Metrics - Aggregatable</h3> <ul><li>時系列のデータを集計した値</li> <li>集計した値なのでリクエストが多くてもサイズは変わらない</li> <li>可視化したい時やトレンドを分析したい時に使う</li> <li>インスタンスが多いとスケールしない
<ul><li>各インスタンスからデータを収集してひとまとめにしたい</li></ul></li> <li>Micrometer
<ul><li>SpringBoot2から入ってる</li> <li>SLAがあればその値をセットしてアラート上がるようにとかできる</li></ul></li> <li>楽天トラベルでは
<ul><li>Micrometer</li> <li>Prometeus</li> <li>Grafana</li></ul></li> <li>Alert
<ul><li>あらゆるサービスにアラート入れると多重アラートが発生してしまう</li> <li>ユーザのリクエストを受けるところだけ設定しておくとよい</li></ul></li></ul> <h3 id="tracing-request-scoped"><a href="#tracing-request-scoped" aria-hidden="true" class="header-anchor">#</a> Tracing - Request scoped</h3> <ul><li>パフォーマンス遅延の原因を調査するために使う</li> <li>リクエストの流れがどうなっているか見るために使う</li> <li>Spring Boot Actuator
<ul><li>トレーシングの情報がとれるエンドポイントを自動で作ってくれる</li></ul></li></ul> <h4 id="destributed-tracing"><a href="#destributed-tracing" aria-hidden="true" class="header-anchor">#</a> Destributed Tracing</h4> <ul><li>インスタンスを跨いだトレーシングをしないといけない</li> <li>一つのリクエストでどのサービスにどれくらい時間がかかったか把握できる必要がある</li> <li>Zipkin</li> <li>Soring Cloud Sleuth: spring-cloud-starter-zipkin</li> <li>楽天トラベルでは
<ul><li>全てのデータをzipkinに送ると負荷があるのでサンプリングしてる</li></ul></li></ul> <h2 id="putting-it-all-together"><a href="#putting-it-all-together" aria-hidden="true" class="header-anchor">#</a> Putting It All Together</h2> <ul><li>3要素はそれぞれ連携してる</li> <li>検知 -&gt; 調査 -&gt; 復旧 のサイクルが回せるようになる</li></ul></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/spring-fest-2018/page10.html" class="prev">
          Knative:Serving your Serverless Java Serviceon Kubernetes the 12-Factor way
        </a></span> <span class="next"><a href="/spring-fest-2018/page12.html">
          AmazonCognito使って認証したい？それならSpring Security使いましょう！
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/spring-fest-2018/assets/js/6.d229d9ff.js" defer></script><script src="/spring-fest-2018/assets/js/app.09634a89.js" defer></script>
  </body>
</html>
