(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{170:function(t,a,s){"use strict";s.r(a);var n=s(0),l=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"content"},[s("h1",{attrs:{id:"実際のプロジェクトでspringアプリをkotlinで開発して得た気づき集"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#実際のプロジェクトでspringアプリをkotlinで開発して得た気づき集","aria-hidden":"true"}},[t._v("#")]),t._v(" 実際のプロジェクトでSpringアプリをKotlinで開発して得た気づき集")]),t._v(" "),s("ul",[s("li",[t._v("⻑澤 太郎(Ubie株式会社)")]),t._v(" "),s("li",[t._v("jkug代表")])]),t._v(" "),s("h2",{attrs:{id:"kotlinでspringを始める"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kotlinでspringを始める","aria-hidden":"true"}},[t._v("#")]),t._v(" KotlinでSpringを始める")]),t._v(" "),s("ul",[s("li",[t._v("Spring InitializrでKotlinを選べるようになってる")])]),t._v(" "),s("h3",{attrs:{id:"クラスにつけるアノテーション"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#クラスにつけるアノテーション","aria-hidden":"true"}},[t._v("#")]),t._v(" クラスにつけるアノテーション")]),t._v(" "),s("ul",[s("li",[t._v("Kotlinのクラスはデフォルトfinal\n"),s("ul",[s("li",[t._v("継承したいならopenってつける必要がある")]),t._v(" "),s("li",[t._v("@Serviceするならopenしないといけない")]),t._v(" "),s("li",[t._v("Kotlin公式のallopenプラグイン\n"),s("ul",[s("li",[t._v("指定したアノテーションをつけるとopenしたことにしてくれる")])])]),t._v(" "),s("li",[t._v("Kotlin公式のkotlin-springプラグイン\n"),s("ul",[s("li",[t._v("@Service等々は自動でopenしてくれる")]),t._v(" "),s("li",[t._v("SpringInitializrで作れば入ってる")])])])])]),t._v(" "),s("li",[t._v("アノテーションの解析ないから速い")])]),t._v(" "),s("h3",{attrs:{id:"バリデーション"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#バリデーション","aria-hidden":"true"}},[t._v("#")]),t._v(" バリデーション")]),t._v(" "),s("ul",[s("li",[t._v("これだとダメ")])]),t._v(" "),s("div",{staticClass:"language-kotlin extra-class"},[s("pre",{pre:!0,attrs:{class:"language-kotlin"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("Xxx")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),s("span",{attrs:{class:"token annotation builtin"}},[t._v("@NotNull")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("val")]),t._v(" age"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" Int"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{attrs:{class:"token annotation builtin"}},[t._v("@NotBlank")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("val")]),t._v(" name"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" String\n"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("ul",[s("li",[t._v("Javaを意識してこう書かないといけない")])]),t._v(" "),s("div",{staticClass:"language-kotlin extra-class"},[s("pre",{pre:!0,attrs:{class:"language-kotlin"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("Xxx")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),s("span",{attrs:{class:"token label symbol"}},[t._v("@field")]),s("span",{attrs:{class:"token operator"}},[t._v(":")]),s("span",{attrs:{class:"token annotation builtin"}},[t._v("@NotNull")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("val")]),t._v(" age"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" Int"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{attrs:{class:"token label symbol"}},[t._v("@field")]),s("span",{attrs:{class:"token operator"}},[t._v(":")]),s("span",{attrs:{class:"token annotation builtin"}},[t._v("@NotBlank")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("val")]),t._v(" name"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" String\n"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("ul",[s("li",[t._v("デフォルトではもともとnull許容しないので注意\n"),s("ul",[s("li",[t._v("?つけるとnull許容型")])])])]),t._v(" "),s("div",{staticClass:"language-kotlin extra-class"},[s("pre",{pre:!0,attrs:{class:"language-kotlin"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("Xxx")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),s("span",{attrs:{class:"token label symbol"}},[t._v("@field")]),s("span",{attrs:{class:"token operator"}},[t._v(":")]),s("span",{attrs:{class:"token annotation builtin"}},[t._v("@NotNull")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("val")]),t._v(" age"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" Int"),s("span",{attrs:{class:"token operator"}},[t._v("?")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{attrs:{class:"token label symbol"}},[t._v("@field")]),s("span",{attrs:{class:"token operator"}},[t._v(":")]),s("span",{attrs:{class:"token annotation builtin"}},[t._v("@NotBlank")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("val")]),t._v(" name"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" String\n"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"webfluxとコルーチン"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#webfluxとコルーチン","aria-hidden":"true"}},[t._v("#")]),t._v(" WebFluxとコルーチン")]),t._v(" "),s("ul",[s("li",[t._v("ReactorはAPIとか覚えることたくさん")]),t._v(" "),s("li",[t._v("Reactorとコルーチンを組み合わせると書きやすい")]),t._v(" "),s("li",[t._v("Reactorの世界とKotlinの世界を処理の途中でいったりきたりできる\n"),s("ul",[s("li",[t._v("async/awaitとか使って書く")])])])]),t._v(" "),s("h2",{attrs:{id:"アノテーションをやめる"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#アノテーションをやめる","aria-hidden":"true"}},[t._v("#")]),t._v(" アノテーションをやめる")]),t._v(" "),s("ul",[s("li",[t._v("アノテーションは黒魔術")]),t._v(" "),s("li",[t._v("Spring5からアノテーションなしでもできる")]),t._v(" "),s("li",[t._v("mainにKotlin DSLで書く\n"),s("ul",[s("li",[t._v("手動でbeanに登録とか")]),t._v(" "),s("li",[s("code",[t._v("@GetMapping")]),t._v("とかも移せるからroutingもそっちに")])])])]),t._v(" "),s("h2",{attrs:{id:"テスト"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#テスト","aria-hidden":"true"}},[t._v("#")]),t._v(" テスト")]),t._v(" "),s("ul",[s("li",[t._v("Spring Test - WebTestClient")]),t._v(" "),s("li",[t._v("AssertJ")]),t._v(" "),s("li",[t._v("MockK")]),t._v(" "),s("li",[t._v("DbSetup-kotlin")])]),t._v(" "),s("h3",{attrs:{id:"junit5"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#junit5","aria-hidden":"true"}},[t._v("#")]),t._v(" JUnit5")]),t._v(" "),s("ul",[s("li",[t._v("@Nestedでグルーピングしやすくなった")]),t._v(" "),s("li",[s("code",[t._v("assertThrows<MyException>")]),t._v("って感じで型引数渡せる")])]),t._v(" "),s("h3",{attrs:{id:"assertj"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#assertj","aria-hidden":"true"}},[t._v("#")]),t._v(" AssertJ")]),t._v(" "),s("ul",[s("li",[t._v(".isNotNullした後でもnullableな値だと?つけないといけない")])]),t._v(" "),s("div",{staticClass:"language-kotlin extra-class"},[s("pre",{pre:!0,attrs:{class:"language-kotlin"}},[s("code",[s("span",{attrs:{class:"token function"}},[t._v("assertThat")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("got"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isNotNull\n"),s("span",{attrs:{class:"token function"}},[t._v("assertThat")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("got"),s("span",{attrs:{class:"token operator"}},[t._v("?")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("isEqualTo")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'test'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("ul",[s("li",[t._v("そもそもデータクラスで比較したほうがエラーのときの情報量が豊富でみやすい")])]),t._v(" "),s("h3",{attrs:{id:"mockk"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mockk","aria-hidden":"true"}},[t._v("#")]),t._v(" MockK")]),t._v(" "),s("ul",[s("li",[t._v("コルーチンは通常特定の場合じゃないと呼び出せない\n"),s("ul",[s("li",[t._v("けど、呼び出せるような仕組みがある")])])]),t._v(" "),s("li",[t._v("mock生成は重いから繰り返さないように注意\n"),s("ul",[s("li",[t._v("各テストの前にclearMokcksすればいい")])])])]),t._v(" "),s("h2",{attrs:{id:"周辺ツール"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#周辺ツール","aria-hidden":"true"}},[t._v("#")]),t._v(" 周辺ツール")]),t._v(" "),s("h3",{attrs:{id:"コーディングガイドライン"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#コーディングガイドライン","aria-hidden":"true"}},[t._v("#")]),t._v(" コーディングガイドライン")]),t._v(" "),s("ul",[s("li",[t._v("ktlint\n"),s("ul",[s("li",[t._v("eslint的な")]),t._v(" "),s("li",[t._v("Linter 兼 formatter")]),t._v(" "),s("li",[t._v("gradleプラグインある")])])]),t._v(" "),s("li",[t._v("シンプルさを保つ\n"),s("ul",[s("li",[t._v("Kotlinの思想として簡潔さではなく読みやすさ重視")])])])]),t._v(" "),s("h2",{attrs:{id:"まとめ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#まとめ","aria-hidden":"true"}},[t._v("#")]),t._v(" まとめ")]),t._v(" "),s("ul",[s("li",[t._v("Kotlinでも普通にSpringアプリ作れる")]),t._v(" "),s("li",[t._v("Javaとの違い意識しないと行けない部分はまだある")]),t._v(" "),s("li",[t._v("Reactorとコルーチン相性良し")]),t._v(" "),s("li",[t._v("アノテーションやめてKotlin DSL")]),t._v(" "),s("li",[t._v("データクラスでテスト結果読みやすく")]),t._v(" "),s("li",[t._v("モックはmockKがよい")])])])}],!1,null,null,null);l.options.__file="page8.md";a.default=l.exports}}]);