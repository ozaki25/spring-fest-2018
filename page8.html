<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>実際のプロジェクトでSpringアプリをKotlinで開発して得た気づき集 | Spring Fest 2018</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/spring-fest-2018/assets/css/styles.09634a89.css" as="style"><link rel="preload" href="/spring-fest-2018/assets/js/app.09634a89.js" as="script"><link rel="preload" href="/spring-fest-2018/assets/js/26.99ce27f6.js" as="script"><link rel="prefetch" href="/spring-fest-2018/assets/css/1.styles.8eb308c1.css"><link rel="prefetch" href="/spring-fest-2018/assets/css/2.styles.a2bd3099.css"><link rel="prefetch" href="/spring-fest-2018/assets/js/1.8eb308c1.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/10.febcc01a.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/11.1cd7b66f.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/12.1f19ecf6.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/13.8b9c0905.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/14.c645b9f5.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/15.38065252.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/16.3e425ef2.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/17.fae3e6e8.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/18.ffb2b096.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/19.790c48e6.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/2.a2bd3099.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/20.c2857ee8.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/21.1daad431.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/22.87665903.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/23.93c086fc.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/24.51308b9b.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/25.4266236e.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/27.9ac45d54.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/3.9378e134.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/4.5c19490d.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/5.ca23a0c0.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/6.d229d9ff.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/7.cdcc80d9.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/8.eac14a68.js"><link rel="prefetch" href="/spring-fest-2018/assets/js/9.5d5663db.js">
    <link rel="stylesheet" href="/spring-fest-2018/assets/css/1.styles.8eb308c1.css"><link rel="stylesheet" href="/spring-fest-2018/assets/css/2.styles.a2bd3099.css"><link rel="stylesheet" href="/spring-fest-2018/assets/css/styles.09634a89.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/spring-fest-2018/" class="home-link router-link-active"><!----> <span class="site-name">Spring Fest 2018</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><!---->  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>10:00〜10:45</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>11:00〜11:45</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>13:15〜14:00</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/spring-fest-2018/page6.html" class="sidebar-link">Rakuten Travel and Spring</a></li><li><a href="/spring-fest-2018/page7.html" class="sidebar-link">Spring ♥ GCP ー SpringとGCPの素敵な関係</a></li><li><a href="/spring-fest-2018/page8.html" class="active sidebar-link">実際のプロジェクトでSpringアプリをKotlinで開発して得た気づき集</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring-fest-2018/page8.html#kotlinでspringを始める" class="sidebar-link">KotlinでSpringを始める</a></li><li class="sidebar-sub-header"><a href="/spring-fest-2018/page8.html#webfluxとコルーチン" class="sidebar-link">WebFluxとコルーチン</a></li><li class="sidebar-sub-header"><a href="/spring-fest-2018/page8.html#アノテーションをやめる" class="sidebar-link">アノテーションをやめる</a></li><li class="sidebar-sub-header"><a href="/spring-fest-2018/page8.html#テスト" class="sidebar-link">テスト</a></li><li class="sidebar-sub-header"><a href="/spring-fest-2018/page8.html#周辺ツール" class="sidebar-link">周辺ツール</a></li><li class="sidebar-sub-header"><a href="/spring-fest-2018/page8.html#まとめ" class="sidebar-link">まとめ</a></li></ul></li><li><a href="/spring-fest-2018/page9.html" class="sidebar-link">Thymeleafさいしょの⼀歩</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>14:15〜15:00</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>15:30〜16:15</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>16:30〜17:15</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>17:30〜18:15</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="実際のプロジェクトでspringアプリをkotlinで開発して得た気づき集"><a href="#実際のプロジェクトでspringアプリをkotlinで開発して得た気づき集" aria-hidden="true" class="header-anchor">#</a> 実際のプロジェクトでSpringアプリをKotlinで開発して得た気づき集</h1> <ul><li>⻑澤 太郎(Ubie株式会社)</li> <li>jkug代表</li></ul> <h2 id="kotlinでspringを始める"><a href="#kotlinでspringを始める" aria-hidden="true" class="header-anchor">#</a> KotlinでSpringを始める</h2> <ul><li>Spring InitializrでKotlinを選べるようになってる</li></ul> <h3 id="クラスにつけるアノテーション"><a href="#クラスにつけるアノテーション" aria-hidden="true" class="header-anchor">#</a> クラスにつけるアノテーション</h3> <ul><li>Kotlinのクラスはデフォルトfinal
<ul><li>継承したいならopenってつける必要がある</li> <li>@Serviceするならopenしないといけない</li> <li>Kotlin公式のallopenプラグイン
<ul><li>指定したアノテーションをつけるとopenしたことにしてくれる</li></ul></li> <li>Kotlin公式のkotlin-springプラグイン
<ul><li>@Service等々は自動でopenしてくれる</li> <li>SpringInitializrで作れば入ってる</li></ul></li></ul></li> <li>アノテーションの解析ないから速い</li></ul> <h3 id="バリデーション"><a href="#バリデーション" aria-hidden="true" class="header-anchor">#</a> バリデーション</h3> <ul><li>これだとダメ</li></ul> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token keyword">class</span> <span class="token function">Xxx</span> <span class="token punctuation">(</span>
  <span class="token annotation builtin">@NotNull</span> <span class="token keyword">val</span> age<span class="token operator">:</span> Int<span class="token punctuation">,</span>
  <span class="token annotation builtin">@NotBlank</span> <span class="token keyword">val</span> name<span class="token operator">:</span> String
<span class="token punctuation">)</span>
</code></pre></div><ul><li>Javaを意識してこう書かないといけない</li></ul> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token keyword">class</span> <span class="token function">Xxx</span> <span class="token punctuation">(</span>
  <span class="token label symbol">@field</span><span class="token operator">:</span><span class="token annotation builtin">@NotNull</span> <span class="token keyword">val</span> age<span class="token operator">:</span> Int<span class="token punctuation">,</span>
  <span class="token label symbol">@field</span><span class="token operator">:</span><span class="token annotation builtin">@NotBlank</span> <span class="token keyword">val</span> name<span class="token operator">:</span> String
<span class="token punctuation">)</span>
</code></pre></div><ul><li>デフォルトではもともとnull許容しないので注意
<ul><li>?つけるとnull許容型</li></ul></li></ul> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token keyword">class</span> <span class="token function">Xxx</span> <span class="token punctuation">(</span>
  <span class="token label symbol">@field</span><span class="token operator">:</span><span class="token annotation builtin">@NotNull</span> <span class="token keyword">val</span> age<span class="token operator">:</span> Int<span class="token operator">?</span><span class="token punctuation">,</span>
  <span class="token label symbol">@field</span><span class="token operator">:</span><span class="token annotation builtin">@NotBlank</span> <span class="token keyword">val</span> name<span class="token operator">:</span> String
<span class="token punctuation">)</span>
</code></pre></div><h2 id="webfluxとコルーチン"><a href="#webfluxとコルーチン" aria-hidden="true" class="header-anchor">#</a> WebFluxとコルーチン</h2> <ul><li>ReactorはAPIとか覚えることたくさん</li> <li>Reactorとコルーチンを組み合わせると書きやすい</li> <li>Reactorの世界とKotlinの世界を処理の途中でいったりきたりできる
<ul><li>async/awaitとか使って書く</li></ul></li></ul> <h2 id="アノテーションをやめる"><a href="#アノテーションをやめる" aria-hidden="true" class="header-anchor">#</a> アノテーションをやめる</h2> <ul><li>アノテーションは黒魔術</li> <li>Spring5からアノテーションなしでもできる</li> <li>mainにKotlin DSLで書く
<ul><li>手動でbeanに登録とか</li> <li><code>@GetMapping</code>とかも移せるからroutingもそっちに</li></ul></li></ul> <h2 id="テスト"><a href="#テスト" aria-hidden="true" class="header-anchor">#</a> テスト</h2> <ul><li>Spring Test - WebTestClient</li> <li>AssertJ</li> <li>MockK</li> <li>DbSetup-kotlin</li></ul> <h3 id="junit5"><a href="#junit5" aria-hidden="true" class="header-anchor">#</a> JUnit5</h3> <ul><li>@Nestedでグルーピングしやすくなった</li> <li><code>assertThrows&lt;MyException&gt;</code>って感じで型引数渡せる</li></ul> <h3 id="assertj"><a href="#assertj" aria-hidden="true" class="header-anchor">#</a> AssertJ</h3> <ul><li>.isNotNullした後でもnullableな値だと?つけないといけない</li></ul> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token function">assertThat</span><span class="token punctuation">(</span>got<span class="token punctuation">)</span><span class="token punctuation">.</span>isNotNull
<span class="token function">assertThat</span><span class="token punctuation">(</span>got<span class="token operator">?</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>そもそもデータクラスで比較したほうがエラーのときの情報量が豊富でみやすい</li></ul> <h3 id="mockk"><a href="#mockk" aria-hidden="true" class="header-anchor">#</a> MockK</h3> <ul><li>コルーチンは通常特定の場合じゃないと呼び出せない
<ul><li>けど、呼び出せるような仕組みがある</li></ul></li> <li>mock生成は重いから繰り返さないように注意
<ul><li>各テストの前にclearMokcksすればいい</li></ul></li></ul> <h2 id="周辺ツール"><a href="#周辺ツール" aria-hidden="true" class="header-anchor">#</a> 周辺ツール</h2> <h3 id="コーディングガイドライン"><a href="#コーディングガイドライン" aria-hidden="true" class="header-anchor">#</a> コーディングガイドライン</h3> <ul><li>ktlint
<ul><li>eslint的な</li> <li>Linter 兼 formatter</li> <li>gradleプラグインある</li></ul></li> <li>シンプルさを保つ
<ul><li>Kotlinの思想として簡潔さではなく読みやすさ重視</li></ul></li></ul> <h2 id="まとめ"><a href="#まとめ" aria-hidden="true" class="header-anchor">#</a> まとめ</h2> <ul><li>Kotlinでも普通にSpringアプリ作れる</li> <li>Javaとの違い意識しないと行けない部分はまだある</li> <li>Reactorとコルーチン相性良し</li> <li>アノテーションやめてKotlin DSL</li> <li>データクラスでテスト結果読みやすく</li> <li>モックはmockKがよい</li></ul></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/spring-fest-2018/page7.html" class="prev">
          Spring ♥ GCP ー SpringとGCPの素敵な関係
        </a></span> <span class="next"><a href="/spring-fest-2018/page9.html">
          Thymeleafさいしょの⼀歩
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/spring-fest-2018/assets/js/26.99ce27f6.js" defer></script><script src="/spring-fest-2018/assets/js/app.09634a89.js" defer></script>
  </body>
</html>
